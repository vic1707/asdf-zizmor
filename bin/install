#!/usr/bin/env bash

set -euo pipefail
set -o errtrace
trap 'say "‚ùå Error on line $LINENO"' ERR

# shellcheck source=lib/utils
. "$(dirname "$0")/../lib/utils"

if [ "$ASDF_INSTALL_TYPE" != "version" ]; then
    fail "This plugin only supports release installs."
fi

TOOL_INSTALL_PATH="$ASDF_INSTALL_PATH/bin"
mkdir -p "$TOOL_INSTALL_PATH"

say "Installing $TOOL_NAME@$ASDF_INSTALL_VERSION"

DL_LINK="$(dl_link)"
[ -n "$DL_LINK" ] || fail "Couldn't find a download URL for $TOOL_NAME."

download "$DL_LINK" \
    | tar -xz -C "$TOOL_INSTALL_PATH"

say "$TOOL_NAME@$ASDF_INSTALL_VERSION installation was successful!"
